!function(){"use strict;";angular.module("app",["ngResource","ngDialog","ui.bootstrap","ui.router","angular-loading-bar"]).run(["$rootScope","$state","$window",function(t,e,n){t.$state=e,t.$on("$stateChangeSuccess",function(){n.scroll(0,0)}),t.wordCount=function(t){var e=t.split(" ");return e.length}}])}(),function(){"use strict;";angular.module("app").config(["$httpProvider","cfpLoadingBarProvider",function(t,e){e.includeSpinner=!1}]).constant("apikeys",{rt:"ydh8p54r6ubt3w5n3scvakg9",tmdb:"ca85ff10880b1490989e8dbeb5932c00"})}(),function(){"use strict;";angular.module("app").config(["$stateProvider","$urlRouterProvider","$locationProvider",function(t,e,n){t.state("front-page",{url:"/",templateUrl:"app/movies/front-page.html",controller:"FrontpageCtrl"}).state("search-results",{url:"/search?q",templateUrl:"app/movies/search-results.html",controller:"SearchCtrl"}).state("movie-page",{url:"/movie/:id",templateUrl:"app/movies/movie-page.html",controller:"MovieCtrl"}).state("in-theaters",{url:"/intheaters",templateUrl:"app/movies/in-theaters.html",controller:"InTheatersCtrl"}).state("opening",{url:"/opening",templateUrl:"app/movies/opening.html",controller:"OpeningCtrl"}).state("upcoming",{url:"/upcoming",templateUrl:"app/movies/upcoming.html",controller:"UpcomingCtrl"}),n.hashPrefix("!"),e.otherwise("/")}]).config(["$httpProvider",function(t){t.interceptors.push(["$rootScope","$q","$window","$location",function(t,e,n,o){return{request:function(t){try{var e=t.params.youtube}catch(o){}return n.localStorage.token&&!e&&(t.headers.Authorization="Bearer "+n.localStorage.token),t},responseError:function(t){return(401===t.status||403===t.status)&&o.path("/"),e.reject(t)}}}])}])}(),function(){"use strict;";angular.module("app").directive("youtubeTrailer",["ngDialog","$sce",function(t,e){return{restrict:"AE",scope:!0,link:function(n,o){n.trailerUrl=e.trustAsResourceUrl("//www.youtube.com/embed/"+n.movie.trailer+"?rel=0&autoplay=1&autohide=1&iv_load_policy=3"),o.bind("click",function(){t.open({template:'<iframe class="trailer-iframe" src="{{trailerUrl}}" frameborder="0" allowfullscreen></iframe>',plain:!0,scope:n,showClose:!1,className:"ngdialog-theme-plain trailer"})})}}}])}(),function(){"use strict;";angular.module("app").filter("noParens",function(){return function(t){t=t||"";var e="",n=t.split(" (");return e=n[0]}})}(),function(){"use strict;";angular.module("app").filter("wordLimit",function(){return function(t){var e="",n=t.split(" "),o=100;if(n.length>o){e=n[0];for(var r=1;o>r;r++)e+=" "+n[r]}else e=t;return e}})}(),function(){"use strict;";function t(t,e,n,o){e.isCollapsed=!1,e.search=function(t){t&&o.go("search-results",{q:t})},e.goHome=function(){o.go("front-page"),e.query=null}}angular.module("app").controller("NavbarCtrl",t),t.$inject=["$rootScope","$scope","$http","$state"]}(),function(){"use strict;";function t(t,e,n,o,r){t.movies=r.getFrontpageMovies(),t.convertDate=function(t){var e=new Date(t),n=e.toDateString(),o=n.split(" "),r=o[1],a=o[2],i=o[3];"0"===a.charAt(0)&&(a=a.substr(1)),i="'"+i.substr(2);var c=r+" "+a+" "+i;return c}}angular.module("app").controller("FrontpageCtrl",t),t.$inject=["$scope","$http","$q","$sce","MovieService"]}(),function(){"use strict;";function t(t,e,n){t.movies=n.getInTheaters(),console.log(t.movies)}angular.module("app").controller("InTheatersCtrl",t),t.$inject=["$scope","$http","MovieService"]}(),function(){"use strict;";function t(t,e,n,o,r){e.id=t.$state.params.id,e.id||n.go("front-page"),e.movie=r.getMovie(e.id),console.log("Movie: ",e.movie)}angular.module("app").controller("MovieCtrl",t),t.$inject=["$rootScope","$scope","$state","$http","MovieService"]}(),function(){"use strict;";function t(t,e,n){t.movies=n.getOpening()}angular.module("app").controller("OpeningCtrl",t),t.$inject=["$scope","$http","MovieService"]}(),function(){"use strict;";function t(t,e,n,o,r){e.query=t.$state.params.q;var a=r.search(e.query);a.then(function(t){e.results=t,0==e.results.length&&(e.error="Sorry, no results found")},function(t){console.log(t)}),e.getDet=function(t){var e=t.replace("_tmb","_det");return e}}angular.module("app").controller("SearchCtrl",t),t.$inject=["$rootScope","$scope","$state","$http","RTService"]}(),function(){"use strict;";function t(t,e,n){t.movies=n.getUpcoming()}angular.module("app").controller("UpcomingCtrl",t),t.$inject=["$scope","$http","MovieService"]}(),function(){"use strict;";function t(t,e,n,o){function r(t){var e=[];return t.then(function(t){angular.forEach(t,function(t){var n=i(t),r=o.search(t.title);r.then(function(t){n.trailer=t,e.push(n)},function(t){console.log(t)})})}),e}function a(t){var e={};return t.then(function(t){try{var r="tt"+t.alternate_ids.imdb,a=n.getMovieByImdb(r);a.then(function(r){if(r){var a=n.getMovieById(r.id);a.then(function(n){if(angular.copy(i(t,n),e),""===e.trailer){var r=o.search(e.title);r.then(function(t){e.trailer=t},function(t){console.log(t)})}},function(t){console.log("No tmdb movie found: ",t)})}else{var c=o.search(t.title);angular.copy(i(t),e),c.then(function(t){e.trailer=t},function(t){console.log(t)})}},function(t){console.log("No tmdb movie found: ",t)})}catch(c){console.log("No imdb id found. ",c);var u=o.search(t.title);angular.copy(i(t),e),u.then(function(t){e.trailer=t},function(t){console.log(t)})}},function(t){console.log(t)}),e}function i(t,e){var n="http://d3biamo577v4eu.cloudfront.net/static/images/redesign/poster_default.gif",o=c(t.posters.detailed),r=u(t.posters.original),a={detailed:o,original:r,notfound:n},i=e||{},l={},p="",f="";try{f=s(t.release_dates.theater)}catch(g){}return l={posters:a,id:t.id,title:t.title,abridged_cast:t.abridged_cast,abridged_directors:t.abridged_directors,synopsis:t.synopsis,ratings:t.ratings,genres:t.genres,release_dates:t.release_dates,theater_release:f,runtime:t.runtime,mpaa_rating:t.mpaa_rating,rtlink:t.links.alternate,tmdb:i,trailer:p}}function c(t){var e=t.replace("_tmb","_det");return e}function u(t){var e=t.replace("_tmb","_ori");return e}function s(t){var e=new Date(t),n=e.toDateString(),o=n.split(" "),r=o[1],a=o[2],i=o[3];"0"===a.charAt(0)&&(a=a.substr(1));var c=r+" "+a+", "+i;return c}var l={};return l.getMovie=function(t){var n=e.getMovie(t);return a(n)},l.getInTheaters=function(t){var n=e.getInTheaters(t);return r(n)},l.getOpening=function(t){var n=e.getOpening(t);return r(n)},l.getUpcoming=function(t){var n=e.getUpcoming(t);return r(n)},l.getFrontpageMovies=function(){var n=e.getInTheaters(6),r=e.getOpening(6),a=e.getUpcoming(6),c=[],u=[],s=[],l={};return t.all([n,r,a]).then(function(t){angular.forEach(t[0],function(t){var e=i(t),n=o.search(t.title);n.then(function(t){e.trailer=t,c.push(e)},function(t){console.log(t)})}),l.intheaters=c,angular.forEach(t[1],function(t){var e=i(t),n=o.search(t.title);n.then(function(t){e.trailer=t,u.push(e)},function(t){console.log(t)})}),l.opening=u,angular.forEach(t[2],function(t){var e=i(t),n=o.search(t.title);n.then(function(t){e.trailer=t,s.push(e)},function(t){console.log(t)})}),l.upcoming=s}),l},l}angular.module("app").factory("MovieService",t),t.$inject=["$q","RTService","TmdbService","YoutubeService"]}(),function(){"use strict;";function t(t,e){var n={},o=t.rt;return n.getMovie=function(t){var n={},r="http://api.rottentomatoes.com/api/public/v1.0/movies/"+t+".json";return e.jsonp(r,{params:{apikey:o,callback:"JSON_CALLBACK"}}).then(function(t){return n=t.data}).catch(function(t){console.log(t)})},n.search=function(t){var n=[],r="http://api.rottentomatoes.com/api/public/v1.0/movies.json";return e.jsonp(r,{params:{apikey:o,q:t,callback:"JSON_CALLBACK"}}).then(function(t){return angular.forEach(t.data.movies,function(t){try{{t.alternate_ids.imdb}n.push(t)}catch(e){}}),n}).catch(function(t){console.log(t)})},n.getInTheaters=function(t){var n=[],r="http://api.rottentomatoes.com/api/public/v1.0/lists/movies/in_theaters.json";return e.jsonp(r,{params:{apikey:o,callback:"JSON_CALLBACK"}}).then(function(e){return angular.forEach(e.data.movies,function(e,o){(t>o||!t)&&n.push(e)}),n}).catch(function(t){console.log(t.data)})},n.getOpening=function(t){var n=[],r="http://api.rottentomatoes.com/api/public/v1.0/lists/movies/opening.json";return e.jsonp(r,{params:{apikey:o,callback:"JSON_CALLBACK"}}).then(function(e){return angular.forEach(e.data.movies,function(e,o){(t>o||!t)&&n.push(e)}),n}).catch(function(t){console.log(t.data)})},n.getUpcoming=function(t){var n=[],r="http://api.rottentomatoes.com/api/public/v1.0/lists/movies/upcoming.json";return e.jsonp(r,{params:{apikey:o,callback:"JSON_CALLBACK"}}).then(function(e){return angular.forEach(e.data.movies,function(e,o){(t>o||!t)&&n.push(e)}),n}).catch(function(t){console.log(t.data)})},n}angular.module("app").factory("RTService",t),t.$inject=["apikeys","$http"]}(),function(){"use strict;";function t(t,e){var n={},o=t.tmdb;return n.getMovieById=function(t){var n={},r="http://api.themoviedb.org/3/movie/"+t+"?api_key="+o+"&append_to_response=videos,credits,releases";return e.get(r).then(function(t){return n=t.data}).catch(function(t){console.log(t)})},n.getMovieByImdb=function(t){var n={},r="http://api.themoviedb.org/3/find/"+t+"?external_source=imdb_id&api_key="+o;return e.get(r).then(function(t){return n=t.data.movie_results[0]}).catch(function(t){console.log(t)})},n}angular.module("app").factory("TmdbService",t),t.$inject=["apikeys","$http"]}(),function(){"use strict;";function t(t){var e={};return e.search=function(e){var n="",o=e+" trailer",r="http://gdata.youtube.com/feeds/api/videos?q="+o+"&format=5&max-results=1&v=2&alt=jsonc";return t.get(r,{params:{youtube:!0}}).then(function(t){var e=t.data.data.items[0];return n=e.id}).catch(function(t){console.log(t)})},e}angular.module("app").factory("YoutubeService",t),t.$inject=["$http"]}();